<!DOCTYPE html>
<html lang="en">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
<head>
    <meta charset="utf-8" />
    <title>Chart.js Example</title>
</head>
<body>
<h1>Stock Prediction - {{ticker}}</h1>
<canvas id="predictionChart" width="1200" height="800"></canvas>

<script>
    Chart.defaults.global.responsive = false;

    var chartData = {
        labels : [{% for item in labels %}
    "{{item}}",
    {% endfor %}],
    datasets : [{
        label: '{{ close_legend }}',
        fill: false,
        lineTension: 0.1,
        backgroundColor: "rgba(75,192,192,0.4)",
        borderColor: "rgba(75,192,192,1)",
        borderCapStyle: 'butt',
        borderDash: [],
        borderDashOffset: 0.0,
        borderJoinStyle: 'miter',
        pointBorderColor: "rgba(75,192,192,1)",
        pointBackgroundColor: "#fff",
        pointBorderWidth: 1,
        pointHoverRadius: 5,
        pointHoverBackgroundColor: "rgba(75,192,192,1)",
        pointHoverBorderColor: "rgba(220,220,220,1)",
        pointHoverBorderWidth: 2,
        pointRadius: 1,
        pointHitRadius: 10,
        data : [{% for item in closes %}
        {{item}},
    {% endfor %}],
    spanGaps: false
    },{
        label: '{{ prediction_legend }}',
            fill: false,
            lineTension: 0.1,
            backgroundColor: "rgb(255, 99, 132)",
            borderColor: "rgba(255, 99, 130, 1)",
            borderCapStyle: 'butt',
            borderDash: [],
            borderDashOffset: 0.0,
            borderJoinStyle: 'miter',
            pointBorderColor: "rgb(255, 99, 132)",
            pointBackgroundColor: "#fff",
            pointBorderWidth: 1,
            pointHoverRadius: 5,
            pointHoverBackgroundColor: "rgb(255, 99, 132)",
            pointHoverBorderColor: "rgba(220,220,220,1)",
            pointHoverBorderWidth: 2,
            pointRadius: 1,
            pointHitRadius: 10,
            data : [{% for item in predictions %}
        {{item}},
        {% endfor %}],
        spanGaps: false
    }]
    }

    // get chart canvas
    var holder = document.getElementById("predictionChart");
    var ctx = document.getElementById("predictionChart").getContext("2d");

    // create the chart using the chart canvas
    var predictionChart = new Chart(ctx, {
        type: 'line',
        data: chartData,
        options: {
            tooltips: {
                enabled: true,
                mode: 'single',
                callbacks: {
                    label: function(tooltipItems, data) {
                        return tooltipItems.yLabel + ' $';
                    }
                }
            },
        }
    });
    var pointSelected = document.getElementById("pointSelected");

    holder.onclick = function(evt){
        var activePoint = predictionChart.getElementAtEvent(evt);
        console.log(activePoint);
        console.log('x:' + activePoint[0]._view.x);
        console.log('maxWidth: ' + activePoint[0]._xScale.maxWidth);
        console.log('y: ' + activePoint[0]._view.y);
        console.log('index: ' + activePoint[0]._index);
        pointSelected.innerHTML = 'Point selected... index: ' + activePoint[0]._index;
    };
</script>

</body>
</html>
